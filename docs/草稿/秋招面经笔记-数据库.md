---
title: 秋招面经笔记-数据库
createTime: 2025/08/15 21:21:17
permalink: /article/i2vph44q/
tags:
- 数据库
- 草稿
---

关系型数据库优点：

- 便于理解（采用关系模型）
- 可以保持数据一致性
- 数据更新的开销小
- 支持复杂查询

非关系型数据库：

NOSQL采用键值对存储，读写性能高，易于扩展，分为内存型数据库和文档型数据库
常见：Redis、MongoDB，HBase等

非关系型数据库优点：

- 不需要经过SQL解析，效率高
- 基于键值对，扩展性好
- 支持更多存储类型（比如图片、文档）

数据库索引：（对数据进行预排序，保证值唯一）创建*唯一性索引*，可以保证数据库表中每行数据的唯一性;加速数据检索（排序、查找树），避免排序和临时表（排序需求），将随机IO变为顺序IO，加速表和表之间的链接

InnoDB使用自增id：自增ID不会产生大量的随机ID，后者会导致对数据库中数据的频繁移动和分页，前者会自然增长到页满后开启新页，后者必须进行插入操作

MyISAM和InnoDB实现B树索引方式的区别：

MyISAM BPLUS树叶节点data域存放数据记录的地址，检索时，按照B+树搜索算法查找，读取data域的指针并读取相应记录（非聚族索引）
InnoDB数据文件本身就按照B+树组织，data保存了完整的数据记录，key为主索引（聚族索引）

MySQL执行一条SQL：

客户端：请求
链接器：验证身份权限
查询缓存
分析器：分析SQL（词法分析、语法分析）
优化器：优化SQL执行方案
执行器：检查执行权限，调用对应引擎接口
从引擎中获取数据（缓存），返回

MySQL分层：

服务层和存储引擎层：

服务层：链接器、查询缓存、分析器、优化器、执行器
存储引擎负责数据的存储和提取（通常是插件式）

Drop Delete Truncate的共同点、区别

都表示删除

Delete删除表的全部或一部分数据行，执行后，用户需要提交commit或者rollback执行删除或撤销操作，触发所有delete触发器
Truncate删除所有数据，不可回滚，也不会触发触发器
Drop删除数据库表，不可回滚，不会触发触发器

MySQL优化：

搜索字段创建索引
避免使用Select *
垂直分割分表
选择正确的存储引擎

并发带来的问题：

- 脏读：读到的数据被回滚
- 幻读：读到修改之前的数据
- 丢弃修改：同时操作数据，后者覆盖前者（并发竞争）
- 不可重复读：一人在读，一人在写，导致读前后读取不一致

数据库隔离级别

- 未提交读：数据的修改没提交、但对其他事务可见，可能导致脏读、不可重复读、幻读
- 提交读：数据的修改提交前，其他事务不可见，可能导致不可重复读、幻读
- 重复读：对一个记录的多次读取都是相同的，可能导致幻读
- 可串行化读：在并发时和串行化读取的结果一致，有效防止脏读、不可重复读、和幻读

但InnoDB在重复读下使用了Next Key Lock 锁算法，达到了可串行化读的效果

隔离等级越低，事务请求的锁越少，大部分数据库都使用提交读，但InnoDB的重复读不会有性能损失

InnoDB在分布式事务下一般使用可串行化隔离级别

数据库索引采用B+树而不是B树：
B+树只需要遍历叶子节点就可以实现对整棵树的遍历，B树只能中序遍历所有节点，效率太低

文件索引和数据库索引为什么使用B+树：

文件和数据库都需要较大的存储，使用时一般不会全部存储到内存中，避免频繁IO操作，B+树比B树更适合，数据库一个节点的大小设为等于一页，每个节点只需要一次IO就可以载入，红黑树等结构高度深得多，并且逻辑上很近的父子节点物理上可能相距很远，无法利用局部性，

此外B+树支持Range Query,直接从叶子节点扫面就可以完成扫库，B树不支持（中序遍历）

B+树查找效率更稳定，B树可能在中间节点找到数据，稳定性不够

B+树没有指向关键字具体信息的指针，内部节点比B树小，相对降低IO次数

B+树查询效率更稳定，任何关键字都必须走根到叶子节点的路线，查询路径长度相同，每个数据的查询效率相当

视图和游标

视图是虚拟的表，通常是一个表或多个表的行列子集，具有和物理表相同的功能

游标是对查询结果集作为一个单元来有效的处理，需要逐条处理数据时，非常有用

MySQL为什么要有事物回滚机制

恢复机制通过回滚日志实现，所有事务的修改会先写入其中，然后再对数据库进行写入

当系统发生崩溃时，用户再次启动数据库，可以通过回滚日志将未完成的事务进行回滚（先写日志后写数据库的原因）

InnoDB和MyISAM的区别

InnoDB是MySQL的默认引擎，只有在需要他不支持的特性时才会使用其他引擎
事务型，支持commit和rollback
支持外键
支持行级锁
实现了四个标准的隔离等级，通过多版本并发控制（MVCC）和Next Key Locking间隙锁防止幻影读
主索引是聚族索引，避免直接读取磁盘
内部做了很多优化，包括从磁盘读取数据时采用可预测性读，加快读操作并且自动创建自适应哈希索引，加速插入操作的插入缓冲等
支持真正的在线热备份
崩溃后恢复率高

MyISAM

设计简单，数据以紧密格式存储，对于只读数据或者表比较小，可以容忍修复操作，则可以使用该引擎
提供了大量特性，比如压缩表，空间数据索引
不支持事物
不支持行级锁，只能对整张表加锁

悲观锁和乐观锁：
悲观锁先获取锁再进行业务（SELECT FOR UPDATE），必须在事务中使用
乐观锁先进行业务，再最后实际更新数据时检查数据是否被更新过（比如利用时间戳等方法实现版本判断）

MySQL索引的数据结构

哈希索引：需求为单条记录查询（哈希表）
B树索引：查询二叉树（B+树）

数据库分库分表

分表可以减少单表负担，将压力分散到不同的表上，提高查询性能，很大地缓解表锁问题

水平分表
库内分表
